<!DOCTYPE html>
<html lang="en">

<head>
    <title>Rashi/Navamsha/Dasha</title>
    <!-- <link rel="stylesheet" href="kundli.css"> -->
    <meta name="description" content="jyotish birth chart">
    <meta name="keywords" content="jyotish,vedic astrology,birth chart,rasi,navamsa,astronomy">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0"> -->
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">-->
    <meta http-equiv="Content-Type" content="text/JSON; charset=UTF-8">

    <script type="text/javascript" src="kundli.js"></script>

</head>

<body>

 

    <script>

        window.onload = generate;

        var name, date, time, tz, lat, lon, latdir, londir, lattmp, lontmp, dn, forward = 0;

        var DEGS = 180 / Math.PI;
        var RADS = Math.PI / 180;
        var EPS = 1.0e-12;

        var planets = [];
        /* D1 zod,house  */
        var mygrahas = [];
        var mybhavas = [];
        var myrashis = [];
        /* D2 zod,house  */
        var myhoraz = [];
        var myhorah = [];
        /* D6 zod,house  */
        var mysashthamshaz = [];
        var mysashthamshah = [];
        /* D8 zod,house  */
        var myashthamsaz = [];
        var myashthamsah = [];
        /* D9 zod,house  */
        var mynavamsaz = [];
        var mynavamsah = [];
        /* D12 zod,house */
        var mydwadashamsaz = [];
        var mydwadashamsah = [];

        var planetsAndPositon = [];


        var index = [2, 2, 6, 6, 8, 8, 9, 9, 12, 12];

        /* Planets or Grahas */
        var AS = 0;  /* Ascendant or Lagna  */
        var SU = 1;  /* Sun     Surya      (Leo)                  South 7th          Sunday     6Y 29D     */
        var MO = 2;  /* Moon    Chandra    (Cancer)               North 7th          Monday    10Y 2D      */
        var MA = 3;  /* Mars    Mangala    (Aries+, Scorpio)      South 4th,7th,8th  Tuesday    7Y 2M5D    */
        var ME = 4;  /* Mercury Budha      (Virgo+, Gemini)       East  7th          Wednesday 17Y 2M9D    */
        var JU = 5;  /* Jupiter Brihaspati (Sagittarius+, Pisces) East  5th,7th,9th  Thursday  16Y 1Y1M11D */
        var VE = 6;  /* Venus   Shukra     (Libra+, Taurus)       North 7th          Friday    20Y 25D     */
        var SA = 7;  /* Saturn  Shani      (Aquarius+,Capricorn)  West  3rd,7th,10th Saturday  19Y 3Y1M24D */
        var RA = 8;  /* Rahu    5th, 7th, 9th 18Y */
        var KE = 9;  /* Ketu    5th, 7th, 9th  7Y */

        /* Sidereal Zodiac Signs(Fixed) or Rashis   */
        var Aries = 1;       /* Mesha      Fire  M Movable Mars    [00-30]   Apr15 - May15 */
        var Taurus = 2;       /* Vrishaba   Earth F Fixed   Venus   [30-60]   May16 - Jun15 */
        var Gemini = 3;       /* Mithuna    Air   M Common  Mercury [60-90]   Jun16 - Jul15 */
        var Cancer = 4;       /* Karkata    Water F Movable Moon    [90-120]  Jul16 - Aug15 */
        var Leo = 5;       /* Simha      Fire  M Fixed   Sun     [120-150] Aug16 - Sep15 */
        var Virgo = 6;       /* Kanya      Earth F Common  Mercury [150-180] Sep16 - Oct15 */
        var Libra = 7;       /* Tula       Air   M Movable Venus   [180-210] Oct16 - Nov15 */
        var Scorpio = 8;       /* Vrishchika Water F Fixed   Mars    [210-240] Nov16 - Dec15 */
        var Sagittarius = 9;     /* Dhanus     Fire  M Common  Jupiter [240-270] Dec16 - Jan14 */
        var Capricorn = 10;    /* Makara     Earth F Movable Saturn  [270-300] Jan15 - Feb14 */
        var Aquarius = 11;      /* Kumbha     Air   M Fixed   Saturn  [300-330] Feb15 - Mar14 */
        var Pisces = 12;      /* Meena      Water F Common  Jupiter [330-360] Mar15 - Apr14 */
        var MAXZOD = 12;      /* Max zodiacs */

        /* Houses or Bhavas */
        function generate() {
            parse_input_data();
            calc_position(false);

            var kun = [];

            for (i = 0; i < myrashis.length; i++) {
                kun[i] = {
                    "planet": mybhavas[i + 1], "rashi": myrashis[i]
                }
            }
            document.write ( JSON.stringify(kun, null, 2));
        }

        function parse_input_data() {

            var url_string =
                window.location.href;


            var url = new URL(url_string);
            var c = url.searchParams.get("a");
            name = (url.searchParams.get("name"));
            parse_date(url.searchParams.get("date"));
            parse_time(url.searchParams.get("time"));
            tz = (url.searchParams.get("tz"));
            parse_latitude(url.searchParams.get("lat").toUpperCase());
            parse_longitude(url.searchParams.get("lon").toUpperCase());


        }

        function parse_date(input) {
            /* Date format: 1901-01-31 | 1901/01/31*/

            date = 0;
            date = new Date(input);
        }

        function parse_time(input) {
            /* Time format: 23:59 | 7:59 | 07:59  */

            time = 0;
            time = new Date();

            var tmp = input.replace(/\s+/g, '');
            tmp = tmp.match(/(\d{1,2})(:(\d\d))/);

            if (tmp[1] < 10) tmp[1] = parseInt(tmp[1], 10);//.replace(/^0+/, '');
            if (tmp[3] < 10) tmp[3] = parseInt(tmp[3], 10);//.replace(/^0+/, '');

            time.setHours(parseInt(tmp[1]) + ((parseInt(tmp[1]) < 12 && tmp[4]) ? 12 : 0));
            time.setMinutes(parseInt(tmp[3]) || 0);
            time.setSeconds(parseInt(0));

            if (parseInt(tmp[1]) >= 24 || parseInt(tmp[3]) > 59 ||
                (parseInt(tmp[1]) == 0 && parseInt(tmp[3]) == 0)) {
                time.setHours(parseInt(0));
                time.setMinutes(parseInt(1));
                document.getElementById('time').value = '00:01';
            }
        }

        function parse_latitude(input) {
            /*  North or South, range between 0 and 90 degrees 
             *  Format: 45N48
             */

            var tmp = input.replace(/\s+/g, "");
            if (tmp.indexOf("N") != -1) {
                lattmp = tmp.split("N");
                lat = dms2real(parseInt(lattmp[0]), parseInt(lattmp[1]), parseInt(0));
            }
            else if (tmp.indexOf("S") != -1) {
                lattmp = tmp.split("S");
                lat = dms2real(parseInt(lattmp[0]), parseInt(lattmp[1]), parseInt(0));
                lat = -lat;
            }
        }

        function parse_longitude(input) {
            /*  East or West, range between 0 and 180 degrees 
             *  Format: 15E58
             */

            var tmp = input.replace(/\s+/g, "");
            if (tmp.indexOf("W") != -1) {
                lontmp = tmp.split("W");
                lon = dms2real(parseInt(lontmp[0]), parseInt(lontmp[1]), parseInt(0));
                lon = -lon;
            }
            else if (tmp.indexOf("E") != -1) {
                lontmp = tmp.split("E");
                lon = dms2real(parseInt(lontmp[0]), parseInt(lontmp[1]), parseInt(0));
            }
        }

        function myplanets(name, index, ra, ruler, r_index, aspect, day,
            happy_zodiac, happy_house, sad_zodiac, sad_house,
            good_friend, bad_friend, transitdeg) {
            this.name = name;
            this.index = index;
            this.ra = ra;
            this.ruler = ruler;
            this.r_index = r_index;
            this.aspect = aspect;
            this.day = day;
            this.happy_zodiac = happy_zodiac;
            this.happy_house = happy_house;
            this.sad_zodiac = sad_zodiac;
            this.sad_house = sad_house;
            this.good_friend = good_friend;
            this.bad_friend = bad_friend;
            this.transitdeg = transitdeg;
            this.house = "";
            this.zodiac = "";
            this.degree = "";
            this.naksha = "";
            this.range = "";
            this.rasizn = ""; /* Rasi zodiac index         */
            this.horadeg = ""; /* Hora degree               */
            this.horazn = ""; /* Hora zodiac index         */
            this.shashdeg = ""; /* Shashthamsa degree        */
            this.shashzn = ""; /* Shashthamsa zodiac index  */
            this.ashtdeg = ""; /* Ashthamsa degree          */
            this.ashtzn = ""; /* Ashthamsa zodiac index    */
            this.navdeg = ""; /* Navamsa degree            */
            this.navzn = ""; /* Navamsa zodiac index      */
            this.dwaddeg = ""; /* Dwadashamsa degree        */
            this.dwadzn = ""; /* Dwadashamsa zodiac index  */
            this.compute = function (transit) {
                if (!transit) this.ra = mod360(this.ra);
                else this.ra = mod360(this.transitdeg);
                // D2 - parasara traditional, 4 and 5
                this.horadeg = ((this.ra - 15.0) - 60.0 * Math.floor((this.ra - 15.0) * (1.0 / 60.0)) + 90);
                this.horazn = calc_zodiac(this.horadeg);
                // D6 - continuos
                this.shashdeg = mod2pi(this.ra * 6.0 * RADS) * DEGS;
                this.shashzn = calc_zodiac(this.shashdeg);
                // D8 - continuos
                this.ashtdeg = mod2pi(this.ra * 8.0 * RADS) * DEGS;
                this.ashtzn = calc_zodiac(this.ashtdeg);
                // D9 - continuos
                this.navdeg = mod2pi(this.ra * 9.0 * RADS) * DEGS;
                this.navzn = calc_zodiac(this.navdeg);
                // D12 - parasara traditional
                var l1 = ((this.ra) - 30.0 * Math.floor((this.ra) * (1.0 / 30.0))) * 12;
                var l2 = parseInt((this.ra / 30)) * 30;
                this.dwaddeg = mod2pi((l2 + l1) * RADS) * DEGS;
                this.dwadzn = calc_zodiac(this.dwaddeg);

                if (this.ra >= 0 && this.ra <= 30) {
                    this.zodiac = "Aries";
                    this.rasizn = 1; this.range = "000-030";
                    this.degree = (this.ra - 0);
                }
                else if (this.ra > 30 && this.ra <= 60) {
                    this.zodiac = "Taurus";
                    this.rasizn = 2; this.range = "030-060";
                    this.degree = (this.ra - 30);
                }
                else if (this.ra > 60 && this.ra <= 90) {
                    this.zodiac = "Gemini";
                    this.rasizn = 3; this.range = "060-090";
                    this.degree = (this.ra - 60);
                }
                else if (this.ra > 90 && this.ra <= 120) {
                    this.zodiac = "Cancer";
                    this.rasizn = 4; this.range = "090-120";
                    this.degree = (this.ra - 90);
                }
                else if (this.ra > 120 && this.ra <= 150) {
                    this.zodiac = "Leo";
                    this.rasizn = 5; this.range = "120-150";
                    this.degree = (this.ra - 120);
                }
                else if (this.ra > 150 && this.ra <= 180) {
                    this.zodiac = "Virgo";
                    this.rasizn = 6; this.range = "150-180";
                    this.degree = (this.ra - 150);
                }
                else if (this.ra > 180 && this.ra <= 210) {
                    this.zodiac = "Libra";
                    this.rasizn = 7; this.range = "180-210";
                    this.degree = (this.ra - 180);
                }
                else if (this.ra > 210 && this.ra <= 240) {
                    this.zodiac = "Scorpio";
                    this.rasizn = 8; this.range = "210-240";
                    this.degree = (this.ra - 210);
                }
                else if (this.ra > 240 && this.ra <= 270) {
                    this.zodiac = "Sagittarius";
                    this.rasizn = 9; this.range = "240-270";
                    this.degree = (this.ra - 240);
                }
                else if (this.ra > 270 && this.ra <= 300) {
                    this.zodiac = "Capricorn";
                    this.rasizn = 10; this.range = "270-300";
                    this.degree = (this.ra - 270);
                }
                else if (this.ra > 300 && this.ra <= 330) {
                    this.zodiac = "Aquarius";
                    this.rasizn = 11; this.range = "300-330";
                    this.degree = (this.ra - 300);
                }
                else if (this.ra > 330 && this.ra <= 360) {
                    this.zodiac = "Pisces";
                    this.rasizn = 12; this.range = "330-360";
                    this.degree = (this.ra - 330);
                }

                this.compute_division_zodiac();
                // this.compute_division_nakshatra();
                this.compute_division_houses();
            }
            this.compute_division_zodiac = function () {
                // D1
                var ay = calc_ayanamsa(false);
                var as = calc_ascendant(time.getHours(), time.getMinutes(), false) - ay;
                var x = 1;
                for (var i = 0; i < MAXZOD; i++) {
                    if (calc_zodiac(as) + i > 12) { myrashis[i] = x; x++; }
                    else { myrashis[i] = calc_zodiac(as) + i; }
                }
                // D2
                var x = 1;
                var deg = ((as - 15.0) - 60.0 * Math.floor((as - 15.0) * (1.0 / 60.0)) + 90);
                for (var i = 0; i < MAXZOD; i++) {
                    if (calc_zodiac(deg) + i > 12) { myhoraz[i] = x; x++; }
                    else { myhoraz[i] = calc_zodiac(deg) + i; }
                }
                // D6
                var x = 1;
                var deg = mod2pi(as * 6.0 * RADS) * DEGS;
                for (var i = 0; i < MAXZOD; i++) {
                    if (calc_zodiac(deg) + i > 12) { mysashthamshaz[i] = x; x++; }
                    else { mysashthamshaz[i] = calc_zodiac(deg) + i; }
                }
                // D8
                var x = 1;
                var deg = mod2pi(as * 8.0 * RADS) * DEGS;
                for (var i = 0; i < MAXZOD; i++) {
                    if (calc_zodiac(deg) + i > 12) { myashthamsaz[i] = x; x++; }
                    else { myashthamsaz[i] = calc_zodiac(deg) + i; }
                }
                // D9
                var x = 1, deg = 0;
                deg = mod2pi(as * 9.0 * RADS) * DEGS;
                for (var i = 0; i < MAXZOD; i++) {
                    if (calc_zodiac(calc_ayanamsa(deg)) + i > 12) { mynavamsaz[i] = x; x++; }
                    else { mynavamsaz[i] = calc_zodiac(calc_ayanamsa(deg)) + i; }
                }
                // D12
                var x = 1, deg = 0;
                var l1 = ((as) - 30.0 * Math.floor((as) * (1.0 / 30.0))) * 12;
                var l2 = parseInt((as / 30)) * 30;
                deg = mod2pi((l2 + l1) * RADS) * DEGS;
                for (var i = 0; i < MAXZOD; i++) {
                    if (calc_zodiac(deg) + i > 12) { mydwadashamsaz[i] = x; x++; }
                    else { mydwadashamsaz[i] = calc_zodiac(deg) + i; }
                }
            }

            this.compute_division_houses = function () {
                // D1
                for (var i = 0; i <= 9; i++) {
                    planets[i] = (mygrahas[i].rasizn);
                }
                calc_houses(myrashis, mybhavas, mygrahas);
                // D2
                for (var i = 0; i <= 9; i++) {
                    planets[i] = (mygrahas[i].horazn);
                }
                calc_houses(myhoraz, myhorah, mygrahas);
                // D6
                for (var i = 0; i <= 9; i++) {
                    planets[i] = (mygrahas[i].shashzn);
                }
                calc_houses(mysashthamshaz, mysashthamshah, mygrahas);
                // D8
                for (var i = 0; i <= 9; i++) {
                    planets[i] = (mygrahas[i].ashtzn);
                }
                calc_houses(myashthamsaz, myashthamsah, mygrahas);
                // D9 
                for (var i = 0; i <= 9; i++) {
                    planets[i] = (mygrahas[i].navzn); //.div name
                }
                calc_houses(mynavamsaz, mynavamsah, mygrahas);
                // D12
                for (var i = 0; i <= 9; i++) {
                    planets[i] = (mygrahas[i].dwadzn);
                }
                calc_houses(mydwadashamsaz, mydwadashamsah, mygrahas);
            }
        };

        function calc_zodiac(_deg) {
            var zodiac;
            var deg = mod360(_deg);

            if (deg >= 0 && deg <= 30) { zodiac = Aries; }
            else if (deg > 30 && deg <= 60) { zodiac = Taurus; }
            else if (deg > 60 && deg <= 90) { zodiac = Gemini; }
            else if (deg > 90 && deg <= 120) { zodiac = Cancer; }
            else if (deg > 120 && deg <= 150) { zodiac = Leo; }
            else if (deg > 150 && deg <= 180) { zodiac = Virgo; }
            else if (deg > 180 && deg <= 210) { zodiac = Libra; }
            else if (deg > 210 && deg <= 240) { zodiac = Scorpio; }
            else if (deg > 240 && deg <= 270) { zodiac = Sagittarius; }
            else if (deg > 270 && deg <= 300) { zodiac = Capricorn; }
            else if (deg > 300 && deg <= 330) { zodiac = Aquarius; }
            else if (deg > 330 && deg <= 360) { zodiac = Pisces; }

            return zodiac;
        }

        function calc_houses(zodiac, house, planetname) {
            house[1] = ""; house[2] = ""; house[3] = ""; house[4] = "";
            house[5] = ""; house[6] = ""; house[7] = ""; house[8] = "";
            house[9] = ""; house[10] = ""; house[11] = ""; house[12] = "";

            var i, j;
            for (i = 0; i <= 11; i++) {
                for (j = 0; j <= 9; j++) {
                    if (j > 9) j = 0;
                    if (zodiac[i] == planets[j] && (i == 0))
                        house[1] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 1)
                        house[2] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 2)
                        house[3] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 3)
                        house[4] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 4)
                        house[5] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 5)
                        house[6] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 6)
                        house[7] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 7)
                        house[8] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 8)
                        house[9] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 9)
                        house[10] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 10)
                        house[11] += planetname[j].name + " ";
                    else if (zodiac[i] == planets[j] && i == 11)
                        house[12] += planetname[j].name + " ";
                }
            }
        }


        function calc_planets_position() {
            var today = new Date();
            dn = calc_day_number(time.getHours(), time.getMinutes(), false);

            var jd = calc_julian_date(time.getHours(), time.getMinutes(), tz, false);
            var jdnow = calc_julian_date(today.getHours(), today.getMinutes(), tz, true);

            var ay = calc_ayanamsa(false);
            var aynow = calc_ayanamsa(true);

            var as = calc_ascendant(time.getHours(), time.getMinutes(), false) - ay;
            var asnow = calc_ascendant(today.getHours(), today.getMinutes(), true) - aynow;

            mygrahas[0] = new myplanets("As", AS, as, "", "", "", "", "", "", "", "", "", "", asnow);

            mygrahas[1] = new myplanets("Su", SU, calc_vsop87(1, jd) - ay, "Leo", Leo, "7th", "Sunday",
                "Le,Ar", "1,5,9,10", "Li", "4,6,7,8,12", "Mo,Ma,Ju", "Sa,Ve",
                calc_vsop87(1, jdnow) - aynow);//calc_ra(0) //0

            mygrahas[2] = new myplanets("Mo", MO, calc_moon_positionIII(false) - ay, "Cancer", Cancer, "7th",
                "Monday", "Ca,Ta", "4,7,9,11,12", "Sc,Cp", "2,3,6,8", "Su,Me", " - ",
                calc_moon_positionIII(true) - aynow);

            mygrahas[3] = new myplanets("Ma", MA, calc_vsop87(3, jd) - ay, "Aries", Aries, "4,7,8th",
                "Tuesday", "Ar,Sc,Cp", "1,3,5,8,10,11", "Ca,Li,Pi", "2,4,6,12", "Su,Mo,Ju", "Me",
                calc_vsop87(3, jdnow) - aynow);  //1

            mygrahas[4] = new myplanets("Me", ME, calc_vsop87(4, jd) - ay, "Virgo", Virgo, "7th",
                "Wednesday", "Vi,Ge", "1,3,5,6,7,10,11", "Sa,Pi", "2,4,8,9,12", "Ve,Su", "Mo",
                calc_vsop87(4, jdnow) - aynow);  //2

            mygrahas[5] = new myplanets("Ju", JU, calc_vsop87(5, jd) - ay, "Sagittarius", Sagittarius, "5,7,9th",
                "Thursday", "Ca", "1,4,5,7,9,10,2,11", "Cp", "2,11", "Su,Mo,Ma", "Ve,Me",
                calc_vsop87(5, jdnow) - aynow);  //3

            mygrahas[6] = new myplanets("Ve", VE, calc_vsop87(6, jd) - ay, "Libra", Libra, "7th",
                "Friday", "Li,Ta,Pi", "1,2,4,5,7.9.11,12", "Sc,Vi", "3,6,8,10", "Sa,Me", "Su,Mo",
                calc_vsop87(6, jdnow) - aynow);  //4

            mygrahas[7] = new myplanets("Sa", SA, calc_vsop87(7, jd) - ay, "Aquarius", Aquarius, "3,7,10th",
                "Saturday", "Li,Cp,Aq", "3,6,7,10,11", "Ar,Ca", "4,5,8,9,12", "Me,Ve", "Su,Mo,Ma",
                calc_vsop87(7, jdnow) - aynow);  //5

            mygrahas[8] = new myplanets("Ra", RA, calc_moon_acending_node(false), "", "", "5,7,9th", "",
                "Ta,Ge,Vi,Li", "1,2,3,5,10,11", "Sg,Ar,Le,Pi", "4,6,7,8,9,12", " - ", " - ",
                calc_moon_acending_node(true));

            mygrahas[9] = new myplanets("Ke", KE, mod360(calc_moon_acending_node(false) + 180), "", "", "5,7,9th", "",
                "Sc,Pi,Sg,Ar", "4,6,8,9,12", "Ta,Ge,Vi,Li", "1,2,3,5,7,10,11", " - ", " - ",
                calc_moon_acending_node(true) + 180);
        }

        function calc_position(transit) {
            calc_planets_position();
            for (var i = 0; i <= 9; i++) { mygrahas[i].compute(transit); }
        }

        function calc_day_number(hours, minutes, transit) {
            /*  day number to/from J2000 */

            var today = new Date(), yy, mm, dd;
            if (!transit) {
                yy = date.getFullYear();
                mm = date.getMonth() + 1;
                dd = date.getDate();
            }
            else {
                yy = today.getFullYear();
                mm = today.getMonth() + 1;
                dd = today.getDate();
            }
            if (mm < 3) { yy -= 1; mm += 12; }

            if (yy * 10000 + mm * 100 + dd > 15821004) { // 15821015
                var a = Math.floor(0.01 * yy);
                var b = 2 - a + Math.floor(0.25 * a);
            }
            else {
                var a = Math.floor(0.01 * yy);
                var b = 0 * (2 - a + Math.floor(0.25 * a));
            }

            var c = Math.floor(365.25 * yy);
            var d = Math.floor(30.6001 * (mm + 1));

            return (b + c + d - 730550.5 + dd + (((hours - tz)) + minutes / 60.0) / 24.0);
        }

        function calc_julian_date(hours, minutes, _tz, transit) {

            var today = new Date(), yy, mm, dd;
            if (!transit) {
                yy = date.getFullYear();
                mm = date.getMonth() + 1;
                dd = date.getDate();
            }
            else {
                yy = today.getFullYear();
                mm = today.getMonth() + 1;
                dd = today.getDate();
            }
            var jy = yy;
            var jm = mm;
            var df;
            if (mm > 2) { jy = yy; jm++; }
            else { jy--; jm += 13; }

            var j = Math.floor(365.25 * jy) + Math.floor(30.6001 * jm) + dd + 1720995.0;
            if (dd + 31 * (mm + 12 * yy) >= 588829) {
                var a = Math.floor(0.01 * jy);
                j += 2 - a + Math.floor(0.25 * a);
            }

            df = (hours - _tz) / 24.0 - 0.5;
            if (df < 0.0) { df += 1.0; --j; }
            var fc = df + (minutes + dT(transit) / 60.0) / 60.0 / 24.0;
            var jd = Math.floor(((j + fc) * 10000000));
            if ((((j + fc) * 10000000) - jd) > 0.5) ++jd;
            else jd *= 1.0;
            return (jd * 0.0000001);
        }

        function calc_day_of_the_week(transit) {
            var jd = calc_julian_date(time.getHours(), time.getMinutes(), 0, transit);
            var day = (Math.floor(jd + 0.5) + 1) % 7;
            var str;

            switch (day) {
                case 0:
                    str = "Sunday";
                    break;
                case 1:
                    str = "Monday";
                    break;
                case 2:
                    str = "Tuesday";
                    break;
                case 3:
                    str = "Wednesday";
                    break;
                case 4:
                    str = "Thursday";
                    break;
                case 5:
                    str = "Friday";
                    break;
                case 6:
                    str = "Saturday";
                    break;
                default:
                    str = "NaN";
            }

            return str;
        }

        function calc_sideral_time(hours, minutes, transit) {
            /*   local mean sideral time [deg] 
             *   West longitudes are negative
             */

            if (londir == "W")
                lon = -lon;

            var t = (calc_day_number(hours, minutes, transit) / 36525.0);
            var tt = t * 36525.0
            var LMST = mod360(280.46061837 + 360.98564736629 * tt
                + 0.000387933 * t * t - (t * t * t) / 38710000 + lon);
            return LMST;
        }



        function calc_vsop87(planet, jd) {

            var X = 0, Y = 1, Z = 2;
            var Xp, Yp, Zp, Rp;
            var Xe, Ye, Ze, Re;
            var Xa, Ya, Za, Ra;

            // number of Julian millenia elapsed from J2000
            var T = (jd - 2451545.0) / 365250.0;

            // calculate heliocentric rectangular coordinates of Earth 
            calc_earth(T);

            // heliocentric rectangular coordinates of Earth 
            Xe = earth[X];
            Ye = earth[Y];
            Ze = earth[Z];

            switch (planet) {
                case 1:
                    Xp = -earth[X];
                    Yp = -earth[Y];
                    Zp = -earth[Z];
                    break;
                case 2:
                    //calc_moon(T);
                    //Xp = moon[X];
                    //Yp = moon[Y];
                    //Zp = moon[Z];
                    break;
                case 3:
                    calc_mars(T);
                    Xp = mars[X];
                    Yp = mars[Y];
                    Zp = mars[Z];
                    break;
                case 4:
                    calc_mercury(T);
                    Xp = mercury[X];
                    Yp = mercury[Y];
                    Zp = mercury[Z];
                    break;
                case 5:
                    calc_jupiter(T);
                    Xp = jupiter[X];
                    Yp = jupiter[Y];
                    Zp = jupiter[Z];
                    break;
                case 6:
                    calc_venus(T);
                    Xp = venus[X];
                    Yp = venus[Y];
                    Zp = venus[Z];
                    break;
                case 7:
                    calc_shani(T);
                    Xp = shani[X];
                    Yp = shani[Y];
                    Zp = shani[Z];
                    break;
                default:
                    window.alert(" error ;) ");
            }

            // Sun coordinates
            if (planet == SU) { Xe = 0; Ye = 0; Ze = 0; }

            // true geocentric ecliptical coordinates 
            Xa = (Xp - Xe);
            Ya = (Yp - Ye);
            Za = (Zp - Ze);

            // spherical geocentric coordinates
            Ra = Math.atan2(Ya, Xa) * DEGS;

            return Ra;
        }


        function calc_moon_positionIII(transit) {
            /*   Jean Meeus "Astronomical Algorithms" 
             *   High precision calculation of the Moon's geocentric longitude 
             */

            var lrCoeff = [60]; for (var i = 0; i < 60; i++) { lrCoeff[i] = [4] }
            lrCoeff = [
                [0, 0, 1, 0], [2, 0, -1, 0], [2, 0, 0, 0], [0, 0, 2, 0], [0, 1, 0, 0], [0, 0, 0, 2], [2, 0, -2, 0],
                [2, -1, -1, 0], [2, 0, 1, 0], [2, -1, 0, 0], [0, 1, -1, 0], [1, 0, 0, 0], [0, 1, 1, 0], [2, 0, 0, -2],
                [0, 0, 1, 2], [0, 0, 1, -2], [4, 0, -1, 0], [0, 0, 3, 0], [4, 0, -2, 0], [2, 1, -1, 0], [2, 1, 0, 0],
                [1, 0, -1, 0], [1, 1, 0, 0], [2, -1, 1, 0], [2, 0, 2, 0], [4, 0, 0, 0], [2, 0, -3, 0], [0, 1, -2, 0],
                [2, 0, -1, 2], [2, -1, -2, 0], [1, 0, 1, 0], [2, -2, 0, 0], [0, 1, 2, 0], [0, 2, 0, 0], [2, -2, -1, 0],
                [2, 0, 1, -2], [2, 0, 0, 2], [4, -1, -1, 0], [0, 0, 2, 2], [3, 0, -1, 0], [2, 1, 1, 0], [4, -1, -2, 0],
                [0, 2, -1, 0], [2, 2, -1, 0], [2, 1, -2, 0], [2, -1, 0, -2], [4, 0, 1, 0], [0, 0, 4, 0], [4, -1, 0, 0],
                [1, 0, -2, 0], [2, 1, 0, -2], [0, 0, 2, -2], [1, 1, 1, 0], [3, 0, -2, 0], [4, 0, -3, 0], [2, -1, 2, 0],
                [0, 2, 1, 0], [1, 1, -1, 0], [2, 0, 3, 0], [2, 0, -1, -2]];

            var bCoeff = [60]; for (var i = 0; i < 60; i++) { bCoeff[i] = [4] }
            bCoeff = [
                [0, 0, 0, 1], [0, 0, 1, 1], [0, 0, 1, -1], [2, 0, 0, -1], [2, 0, -1, 1], [2, 0, -1, -1], [2, 0, 0, 1],
                [0, 0, 2, 1], [2, 0, 1, -1], [0, 0, 2, -1], [2, -1, 0, -1], [2, 0, -2, -1], [2, 0, 1, 1], [2, 1, 0, -1],
                [2, -1, -1, 1], [2, -1, 0, 1], [2, -1, -1, -1], [0, 1, -1, -1], [4, 0, -1, -1], [0, 1, 0, 1], [0, 0, 0, 3],
                [0, 1, -1, 1], [1, 0, 0, 1], [0, 1, 1, 1], [0, 1, 1, -1], [0, 1, 0, -1], [1, 0, 0, -1], [0, 0, 3, 1],
                [4, 0, 0, -1], [4, 0, -1, 1], [0, 0, 1, -3], [4, 0, -2, 1], [2, 0, 0, -3], [2, 0, 2, -1], [2, -1, 1, -1],
                [2, 0, -2, 1], [0, 0, 3, -1], [2, 0, 2, 1], [2, 0, -3, -1], [2, 1, -1, 1], [2, 1, 0, 1], [4, 0, 0, 1],
                [2, -1, 1, 1], [2, -2, 0, -1], [0, 0, 1, 3], [2, 1, 1, -1], [1, 1, 0, -1], [1, 1, 0, 1], [0, 1, -2, -1],
                [2, 1, -1, -1], [1, 0, 1, 1], [2, -1, -2, -1], [0, 1, 2, 1], [4, 0, -2, -1], [4, -1, -1, -1], [1, 0, 1, -1],
                [4, 0, 1, -1], [1, 0, -1, -1], [4, -1, 0, -1], [2, -2, 0, 1]];

            var lTerms = [
                6288774, 1274027, 658314, 213618, -185116, -114332, 58793, 57066, 53322, 45758, -40923, -34720,
                -30383, 15327, -12528, 10980, 10675, 10034, 8548, -7888, -6766, -5163, 4987, 4036, 3994, 3861, 3665,
                -2689, -2602, 2390, -2348, 2236, -2120, -2069, 2048, -1773, -1595, 1215, -1110, -892, -810, 759, -713,
                -700, 691, 596, 549, 537, 520, -487, -399, -381, 351, -340, 330, 327, -323, 299, 294, 0];

            var rTerms = [
                -20905355, -3699111, -2955968, -569925, 48888, -3149, 246158, -152138, -170733, -204586, -129620,
                108743, 104755, 10321, 0, 79661, -34782, -23210, -21636, 24208, 30824, -8379, -16675, -12831, -10445,
                -11650, 14403, -7003, 0, 10056, 6322, -9884, 5751, 0, -4950, 4130, 0, -3958, 0, 3258, 2616, -1897, -2117,
                2354, 0, 0, -1423, -1117, -1571, -1739, 0, -4421, 0, 0, 0, 0, 1165, 0, 0, 8752];

            var bTerms = [
                5128122, 280602, 277693, 173237, 55413, 46271, 32573, 17198, 9266, 8822, 8216, 4324, 4200, -3359, 2463,
                2211, 2065, -1870, 1828, -1794, -1749, -1565, -1491, -1475, -1410, -1344, -1335, 1107, 1021, 833, 777, 671,
                607, 596, 491, -451, 439, 422, 421, -366, -351, 331, 315, 302, -283, -229, 223, 223, -220, -220, -185, 181, -177,
                176, 166, -164, 132, -119, 115, 107];

            var lprime, d, m, mprime, f, a1, a2, a3, e = [], sigmaL = 0, sigmaB = 0, sigmaR = 0, ang, today = new Date(), t;
            if (!transit) t = (calc_julian_date(time.getHours(), time.getMinutes(), tz, transit) - 2451545.0) / 36525.0;
            else t = (calc_julian_date(today.getHours(), today.getMinutes(), tz, transit) - 2451545.0) / 36525.0;
            var t4 = t * t * t * t;
            var t3 = t * t * t;
            var t2 = t * t;

            lprime = mod2pi((218.3164591 + 481267.88134236 * t - 0.0013268 * t2 + t3 / 538841.0 - t4 / 65194000.0) * RADS);
            d = mod2pi((297.8502042 + 445267.1115168 * t - 0.00163 * t2 + t3 / 545868.0 - t4 / 113065000.0) * RADS);
            m = mod2pi((357.5291092 + 35999.0502909 * t - 0.0001536 * t2 + t3 / 24490000.0) * RADS);
            mprime = mod2pi((134.9634114 + 477198.8676313 * t + 0.008997 * t2 + t3 / 69699.0 - t4 / 14712000.0) * RADS);
            f = mod2pi((93.2720993 + 483202.0175273 * t - 0.0034029 * t2 - t3 / 3526000.0 + t4 / 863310000.0) * RADS);

            a1 = mod2pi((119.75 + 131.849 * t) * RADS);
            a2 = mod2pi((53.09 + 479264.29 * t) * RADS);
            a3 = mod2pi((313.45 + 481266.484 * t) * RADS);

            e[0] = 1;
            e[1] = 1 - 0.002516 * t - 0.0000074 * t2;
            e[2] = e[1] * e[1];

            for (i = 0; i < 60; i++) {
                ang = lrCoeff[i][0] * d + lrCoeff[i][1] * m + lrCoeff[i][2] * mprime + lrCoeff[i][3] * f;
                sigmaL += lTerms[i] * Math.sin(ang) * e[Math.abs(lrCoeff[i][1])];

                if (rTerms[i] != 0) {
                    sigmaR += rTerms[i] * Math.cos(ang) * e[Math.abs(lrCoeff[i][1])];
                }

                ang = bCoeff[i][0] * d + bCoeff[i][1] * m + bCoeff[i][2] * mprime + bCoeff[i][3] * f;
                sigmaB += bTerms[i] * Math.sin(ang) * e[Math.abs(bCoeff[i][1])];
            }

            sigmaL += 3958.0 * Math.sin(a1) + 1962.0 * Math.sin(lprime - f) + 318.0 * Math.sin(a2);
            sigmaB += - 2235.0 * Math.sin(lprime) + 382.0 * Math.sin(a3) + 175.0 * Math.sin(a1 - f)
                + 175.0 * Math.sin(a1 + f) + 127.0 * Math.sin(lprime - mprime)
                - 115.0 * Math.sin(lprime + mprime);

            l = mod2pi(((lprime * DEGS) + sigmaL / 1000000.0) * RADS) * DEGS;

            return l;
        }

        function _ecl(jd) {
            /* J. Laskar, Astronomy and Astrophysics, Vol. 157, page 68 [1986] */

            var terms = [-4680.93 / 3600.0, -1.55 / 3600.0, 1999.25 / 3600.0,
            -51.38 / 3600.0, -249.67 / 3600.0, -39.05 / 3600.0,
            7.12 / 3600.0, 27.87 / 3600.0, 5.79 / 3600.0, 2.45 / 3600.0];

            var eps = 23 + (26 / 60.0) + (21.448 / 3600.0);
            var u = 0, v = 0;
            var cy = jd / 36525.0;
            v = u = (jd - 2415020.0) / (cy * 100);

            if (Math.abs(u) < 1.0) {
                for (var i = 0; i < 10; i++) {
                    eps += terms[i] * v;
                    v *= u;
                }
            }

            return eps;
        }

        function dT(transit) {


            var today = new Date(), y;
            if (!transit) y = date.getFullYear() + ((date.getMonth() + 1) - 0.5) / 12;
            else y = today.getFullYear() + ((today.getMonth() + 1) - 0.5) / 12;

            var c = -0.000012932 * Math.pow((y - 1955), 2);
            var dt = 0, u = 0, t = 0;
            t2 = t * t;
            t3 = t * t * t;
            t4 = t * t * t * t;
            t5 = t4 * t;
            t6 = t5 * t;
            t7 = t6 * t;

            if (y <= -500) {
                u = (y - 1820) / 100;
                dt = -20 + 32 * u * u + c;
            }
            else if (y < -500 && y <= 500) {
                u = y / 100;
                dt = 10583.6 - 1014.41 * u + 33.78311 * u * u - 5.952053 * u * u * u
                    - 0.1798452 * u * u * u * u + 0.022174192 * u * u * u * u * u + 0.0090316521 * u * u * u * u * u * u + c;
            }
            else if (y > 500 && y <= 1600) {
                u = (y - 1000) / 100;
                dt = 1574.2 - 556.01 * u + 71.23472 * u * u + 0.319781 * u * u * u
                    - 0.8503463 * u * u * u * u - 0.005050998 * u * u * u * u * u + 0.0083572073 * u * u * u * u * u * u + c;
            }
            else if (y > 1600 && y <= 1700) {
                t = (y - 1600);
                dt = 120 - 0.9808 * t - 0.01532 * t2 + t3 / 7129 + c;
            }
            else if (y > 1700 && y <= 1800) {
                t = (y - 1800);
                dt = 13.72 - 0.332447 * t + 0.0068612 * t2 + 0.0041116 * t3
                    - 0.00037436 * t4 + 0.0000121272 * t5 - 0.0000001699 * t6
                    + 0.000000000875 * t7 + c;
            }
            else if (y > 1860 && y <= 1900) {
                t = (y - 1860);
                dt = 7.62 + 0.5737 * t - 0.251754 * t2 + 0.01680668 * t3
                    - 0.0004473624 * t4 + t5 / 233174 + c;
            }
            else if (y > 1900 && y <= 1920) {
                t = (y - 1920);
                dt = 21.20 + 0.84493 * t - 0.076100 * t2 + 0.0020936 * t3 + c;
            }
            else if (y > 1941 && y <= 1961) {
                t = (y - 1950);
                dt = 29.07 + 0.407 * t - t2 / 233 + t3 / 2547;
            }
            else if (y > 1961 && y <= 1986) {
                t = (y - 1975);
                dt = 45.45 + 1.067 * t - t2 / 260 - t3 / 718;
            }
            else if (y > 1986 && y <= 2005) {
                t = (y - 2000);
                dt = 3.86 + 0.3345 * t - 0.060374 * t2 + 0.0017275 * t3
                    + 0.000651814 * t4 + 0.00002373599 * t5;
            }
            else if (y > 2005 && y <= 2050) {
                t = (y - 2000);
                dt = 62.92 + 0.32217 * t + 0.005589 * t2 + c;
            }
            else if (y > 2050 && y <= 2150) {
                dt = -20 + 32 * ((y - 1820) / 100) * ((y - 1820) / 100) - 0.5628 * (2150 - y) + c;
            }
            else if (y > 2150) {
                u = (y - 1820) / 100;
                dt = -20 + 32 * u * u + c;
            }

            return dt;
        }

        function dms2real(deg, min, sec) {
            /*  convert latitude/longitude (deg, min, sec) to degrees  */

            var r;
            if (deg < 0) r = deg - min / 60 - sec / 3600;
            else r = deg + min / 60 + sec / 3600;

            return r;
        }


        function _abs(x) {
            var r;
            if (x >= 0.0) r = Math.floor(x);
            else r = Math.ceil(x);

            return r;
        }

        function mod24(x) {
            return (x + 24) % 24;
        }

        function mod2pi(x) {
            /* range 0-2PI radians */

            var b = x / (2 * Math.PI);
            var a = (2 * Math.PI) * (b - _abs(b));
            if (a < 0) a = (2 * Math.PI) + a;

            return a;
        }

        function mod360(x) {
            /* range 0-360 degrees */

            var a = 360 * ((x / 360) - _abs(x / 360));
            if (a < 0) a = a + 360;

            return a;
        }

        function calc_moon_acending_node(transit) {
            /*   http://idlastro.gsfc.nasa.gov
             *   Q.What is the licensing for the IDL Astronomy Library?
             *   A.The IDL Astronomy Library procedures are in the public domain. 
             */

            var T, today = new Date(), ay, n;
            if (!transit) T = (calc_julian_date(time.getHours(), time.getMinutes(), tz, transit) - 2415020.5) / 36525.0;
            else T = (calc_julian_date(today.getHours(), today.getMinutes(), tz, transit) - 2415020.5) / 36525.0;
            ay = calc_ayanamsa(transit);

            /* compute longitude of Moon's ascending node */
            n = mod2pi((259.183275 - 1800 * T - 134.142008 * T + 0.002078 * T * T) * RADS) * DEGS;

            return (n - ay);
        }

        function calc_ayanamsa(transit) {
            /*   The longitudinal difference between the
             *   Tropical(Sayana) and Sidereal(Nirayana) zodiacs.
             */

            var d, today = new Date(), yy, mm, dd;
            if (!transit) {
                yy = date.getFullYear();
                mm = date.getMonth() + 1;
                dd = date.getDate();
            }
            else {
                yy = today.getFullYear();
                mm = today.getMonth() + 1;
                dd = today.getDate();
            }
            if (yy < 100) d = 10.;
            else d = 1000.;
            var c = yy * 1.0 / d;
            var a = -6.92416 + 16.90709 * c - 0.757371 * c * c;
            var b = (mm + dd / 30.) * 1.1574074 / d;

            return (a + b);
        }

        function calc_ascendant(hours, minutes, transit) {

            var t = calc_sideral_time(hours, minutes, transit);
            var ecl = _ecl(calc_julian_date(hours, minutes, tz, transit));

            var asc = Math.atan2(Math.cos(t * RADS), -Math.sin(t * RADS) * Math.cos(ecl * RADS)
                - Math.tan(lat * RADS) * Math.sin(ecl * RADS));

            return (asc * DEGS);
        }



    </script>

</body>

</html> <!-- The End -->